<!doctype html><html class="not-ready text-sm lg:text-base" style=--bg:#fff lang=ru-ru><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Mikrotik Configuration - DEVNOTE</title><meta name=theme-color><meta name=description content="Mikrotik:General Обозначения букв в интерфейсе WinBox [Mikrotik] Буква Обозначение X Интерфейс выключен. R Означает что интерфейс включён, что соответствует активным светодиодам на самом устройстве. S Ведомый (Slave). Mikrotik:Firewall Обозначения букв в интерфейсе таблиц Firewall Буква Обозначение E expected (ожидаемый) S seen-reply (увиденный-ответ) A assured (уверенный) C confirmed (подтверждённый) D dying (умирающий) F fasttrack s srcnat (источник NAT) d dstnat (получатель NAT) Firewall Action В цепочках можно осуществлять следующие действия
Параметр Действие Accept Разрешить add-dst-to-address-list Добавить ip назначение в список адресов указанный в Address List add-src-to-address-list Добавить ip источника в список адресов указанный в Address List Drop запретить fasttrack-connection Обрабатывать пакеты включив FastTrack т."><meta name=author content="DEVNOTE"><link rel="preload stylesheet" as=style href=https://devnote.cc/main.min.css><script defer src=https://devnote.cc/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=preload as=image href=https://devnote.cc/theme.png><link rel=preload as=image href=https://devnote.cc/github.svg><link rel=preload as=image href=https://devnote.cc/cv.svg><link rel=icon href=https://devnote.cc/favicon.ico><link rel=apple-touch-icon href=https://devnote.cc/apple-touch-icon.png><meta name=generator content="Hugo 0.111.3"><meta property="og:title" content="Mikrotik Configuration"><meta property="og:description" content="Mikrotik:General Обозначения букв в интерфейсе WinBox [Mikrotik] Буква Обозначение X Интерфейс выключен. R Означает что интерфейс включён, что соответствует активным светодиодам на самом устройстве. S Ведомый (Slave). Mikrotik:Firewall Обозначения букв в интерфейсе таблиц Firewall Буква Обозначение E expected (ожидаемый) S seen-reply (увиденный-ответ) A assured (уверенный) C confirmed (подтверждённый) D dying (умирающий) F fasttrack s srcnat (источник NAT) d dstnat (получатель NAT) Firewall Action В цепочках можно осуществлять следующие действия
Параметр Действие Accept Разрешить add-dst-to-address-list Добавить ip назначение в список адресов указанный в Address List add-src-to-address-list Добавить ip источника в список адресов указанный в Address List Drop запретить fasttrack-connection Обрабатывать пакеты включив FastTrack т."><meta property="og:type" content="article"><meta property="og:url" content="https://devnote.cc/posts/mikrotikconfiguration/mikrotik/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-20T09:03:20-08:00"><meta property="article:modified_time" content="2022-11-20T09:03:20-08:00"><meta itemprop=name content="Mikrotik Configuration"><meta itemprop=description content="Mikrotik:General Обозначения букв в интерфейсе WinBox [Mikrotik] Буква Обозначение X Интерфейс выключен. R Означает что интерфейс включён, что соответствует активным светодиодам на самом устройстве. S Ведомый (Slave). Mikrotik:Firewall Обозначения букв в интерфейсе таблиц Firewall Буква Обозначение E expected (ожидаемый) S seen-reply (увиденный-ответ) A assured (уверенный) C confirmed (подтверждённый) D dying (умирающий) F fasttrack s srcnat (источник NAT) d dstnat (получатель NAT) Firewall Action В цепочках можно осуществлять следующие действия
Параметр Действие Accept Разрешить add-dst-to-address-list Добавить ip назначение в список адресов указанный в Address List add-src-to-address-list Добавить ip источника в список адресов указанный в Address List Drop запретить fasttrack-connection Обрабатывать пакеты включив FastTrack т."><meta itemprop=datePublished content="2022-11-20T09:03:20-08:00"><meta itemprop=dateModified content="2022-11-20T09:03:20-08:00"><meta itemprop=wordCount content="803"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Mikrotik Configuration"><meta name=twitter:description content="Mikrotik:General Обозначения букв в интерфейсе WinBox [Mikrotik] Буква Обозначение X Интерфейс выключен. R Означает что интерфейс включён, что соответствует активным светодиодам на самом устройстве. S Ведомый (Slave). Mikrotik:Firewall Обозначения букв в интерфейсе таблиц Firewall Буква Обозначение E expected (ожидаемый) S seen-reply (увиденный-ответ) A assured (уверенный) C confirmed (подтверждённый) D dying (умирающий) F fasttrack s srcnat (источник NAT) d dstnat (получатель NAT) Firewall Action В цепочках можно осуществлять следующие действия
Параметр Действие Accept Разрешить add-dst-to-address-list Добавить ip назначение в список адресов указанный в Address List add-src-to-address-list Добавить ip источника в список адресов указанный в Address List Drop запретить fasttrack-connection Обрабатывать пакеты включив FastTrack т."></head><body class="text-black duration-200 ease-out dark:text-white"><header class="mx-auto flex h-[5rem] max-w-3xl px-8 lg:justify-center"><div class="relative z-50 mr-auto flex items-center"><a class="-translate-x-[1px] -translate-y-0.5 text-3xl font-bold" href=https://devnote.cc/>DEVNOTE</a><div class="btn-dark text-[0] ml-6 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.svg)_left_center/cover_no-repeat] dark:invert dark:[background-position:right]" role=button aria-label=Dark></div></div><div class="btn-menu relative z-50 -mr-8 flex h-[5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden" role=button aria-label=Menu></div><script>const htmlClass=document.documentElement.classList;setTimeout(()=>{htmlClass.remove("not-ready")},10);const btnMenu=document.querySelector(".btn-menu");btnMenu.addEventListener("click",()=>{htmlClass.toggle("open")});const metaTheme=document.querySelector('meta[name="theme-color"]'),lightBg=`"#fff"`.replace(/"/g,""),setDark=e=>{metaTheme.setAttribute("content",e?"#000":lightBg),htmlClass[e?"add":"remove"]("dark"),localStorage.setItem("dark",e)},darkScheme=window.matchMedia("(prefers-color-scheme: dark)");if(htmlClass.contains("dark"))setDark(!0);else{const e=localStorage.getItem("dark");setDark(e?e==="true":darkScheme.matches)}darkScheme.addEventListener("change",e=>{setDark(e.matches)});const btnDark=document.querySelector(".btn-dark");btnDark.addEventListener("click",()=>{setDark(localStorage.getItem("dark")!=="true")})</script><div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"><nav class="mt-12 flex justify-center space-x-10 dark:invert lg:mt-0 lg:ml-12 lg:items-center lg:space-x-6"><a class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./github.svg) href=https://github.com/osipud target=_blank rel=me>github</a>
<a class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./cv.svg) href=https://devnote.cc/cv target=_blank rel=me>cv</a></nav></div></header><main class="prose prose-neutral relative mx-auto min-h-[calc(100%-10rem)] max-w-3xl px-8 pt-16 pb-24 dark:prose-invert"><article><header class=mb-20><h1 class="!my-0 pb-2.5">Mikrotik Configuration</h1><div class="text-sm opacity-60"><time>Nov 20, 2022</time></div></header><section><h2 id=mikrotikgeneral>Mikrotik:General</h2><h3 id=обозначения-букв-в-интерфейсе-winbox-mikrotik>Обозначения букв в интерфейсе WinBox [Mikrotik]</h3><table><thead><tr><th style=text-align:center><strong>Буква</strong></th><th><strong>Обозначение</strong></th></tr></thead><tbody><tr><td style=text-align:center><strong>X</strong></td><td>Интерфейс выключен.</td></tr><tr><td style=text-align:center><strong>R</strong></td><td>Означает что интерфейс включён, что соответствует активным светодиодам на самом устройстве.</td></tr><tr><td style=text-align:center><strong>S</strong></td><td>Ведомый (Slave).</td></tr></tbody></table><h2 id=mikrotikfirewall>Mikrotik:Firewall</h2><p><img src=../mikrotik.jpg alt="Изображение устройства Mikrotik"></p><h3 id=обозначения-букв-в-интерфейсе-таблиц-firewall>Обозначения букв в интерфейсе таблиц Firewall</h3><table><thead><tr><th style=text-align:center>Буква</th><th><strong>Обозначение</strong></th></tr></thead><tbody><tr><td style=text-align:center><strong>E</strong></td><td>expected (ожидаемый)</td></tr><tr><td style=text-align:center><strong>S</strong></td><td>seen-reply (увиденный-ответ)</td></tr><tr><td style=text-align:center><strong>A</strong></td><td>assured (уверенный)</td></tr><tr><td style=text-align:center><strong>C</strong></td><td>confirmed (подтверждённый)</td></tr><tr><td style=text-align:center><strong>D</strong></td><td>dying (умирающий)</td></tr><tr><td style=text-align:center><strong>F</strong></td><td>fasttrack</td></tr><tr><td style=text-align:center><strong>s</strong></td><td>srcnat (источник <strong>NAT</strong>)</td></tr><tr><td style=text-align:center><strong>d</strong></td><td>dstnat (получатель <strong>NAT</strong>)</td></tr></tbody></table><h2 id=firewall-action><strong>Firewall</strong> <strong>Action</strong></h2><p>В цепочках можно осуществлять следующие действия</p><table><thead><tr><th style=text-align:center><strong>Параметр</strong></th><th><strong>Действие</strong></th></tr></thead><tbody><tr><td style=text-align:center><strong>Accept</strong></td><td>Разрешить</td></tr><tr><td style=text-align:center><strong>add-dst-to-address-list</strong></td><td>Добавить ip назначение в список адресов указанный в Address List</td></tr><tr><td style=text-align:center><strong>add-src-to-address-list</strong></td><td>Добавить ip источника в список адресов указанный в Address List</td></tr><tr><td style=text-align:center><strong>Drop</strong></td><td>запретить</td></tr><tr><td style=text-align:center><strong>fasttrack-connection</strong></td><td>Обрабатывать пакеты включив FastTrack т.е пакеты будут проходить по самому быстрому маршруту, минуя остальные правила firewall и обработку в очередях</td></tr><tr><td style=text-align:center><strong>Jump</strong></td><td>Прыжок, переход на другую цепочку заданную в Jump target</td></tr><tr><td style=text-align:center><strong>log</strong></td><td>Запись в лог</td></tr><tr><td style=text-align:center><strong>passthrough</strong></td><td>Перейти к следующему правилу не делая никаких действий(полезно для сбора статистики)</td></tr><tr><td style=text-align:center><strong>Reject</strong></td><td>Отбить пакет с причиной указанной в Reject with</td></tr><tr><td style=text-align:center><strong>Return</strong></td><td>Вернуть пакет в цепочку из который он пришел</td></tr><tr><td style=text-align:center><strong>tarpit</strong></td><td>захватывает и поддерживает TCP-соединения (отвечает с SYN / ACK на входящий пакет TCP SYN)</td></tr></tbody></table><h2 id=фильтрация-в-firewall><strong>Фильтрация в firewall</strong></h2><p>Фильтрация пакетов которые могут попасть в цепочки может осуществляться по</p><table><thead><tr><th><strong>Параметр</strong></th><th><strong>Описание</strong></th></tr></thead><tbody><tr><td><strong>Src.Address</strong></td><td>адрес источника</td></tr><tr><td><strong>Dst.Address</strong></td><td>адрес назначения</td></tr><tr><td><strong>Protocol</strong></td><td>Протокол(TCP, UDP и т.д)</td></tr><tr><td><strong>Src.Port</strong></td><td>порт источника</td></tr><tr><td><strong>Dst.Port</strong></td><td>порт назначения</td></tr><tr><td><strong>In.Interface</strong></td><td>входящий интерфейс</td></tr><tr><td><strong>Out.Interface</strong></td><td>исходящий интерфейс</td></tr><tr><td><strong>Packet.Mark</strong></td><td>метка пакета</td></tr><tr><td><strong>Connection.Mark</strong></td><td>метка соединения</td></tr><tr><td><strong>Routing Mark</strong></td><td>метка маршрута</td></tr><tr><td><strong>Routing table</strong></td><td>адрес получателя которых разрешен в конкретной таблице маршрутизации</td></tr><tr><td><strong>Connection Type</strong></td><td>тип соединения</td></tr><tr><td><strong>Connection State</strong></td><td>состояние соединения (установлено, новое и т.д)</td></tr><tr><td><strong>Connection NAT State</strong></td><td>цепочка NAT (srcnat, dstnat</td></tr></tbody></table><h3 id=обозначения-терминов-в-интерфейсе-ipfirewall>Обозначения терминов в интерфейсе IP:Firewall</h3><table><thead><tr><th>Термин</th><th><strong>Обозначение</strong></th></tr></thead><tbody><tr><td><strong>Filter</strong></td><td>занимается фильтрацией трафика — определяет, пропустить пакет в сеть или отбросить его. Мы будем рассматривать работу только этой таблицы;</td></tr><tr><td><strong>NAT</strong></td><td>Network Address Translation. Изменяет проходящие пакеты. Поменять адрес источника или порт назначения — дело именно этой таблицы. В основном она используется для обеспечения доступа в интернет из локальной сети и обратно. Иногда без NAT невозможно работать в плохо спроектированных сетях, а ещё его, бывает, используют в качестве «костыля»;</td></tr><tr><td><strong>Mangle</strong></td><td>классифицирует и маркирует трафик и может менять некоторые поля в заголовке (TTL, ToS, DF). Применяется для построения сложных путей трафика (например, когда подключено два провайдера или нужны разные пути трафика для RDP и VoIP);</td></tr><tr><td><strong>RAW</strong></td><td>обрабатывает пакеты до их попадания в Connection Tracking. Пригодится для защиты от DoS или при работе с большими объёмами трафика.</td></tr></tbody></table><h3 id=цепочка-обработки-в-таблице-ipfirewallfilter>Цепочка обработки в таблице IP:Firewall:Filter</h3><table><thead><tr><th style=text-align:center>Термин</th><th><strong>Обозначение</strong></th></tr></thead><tbody><tr><td style=text-align:center><strong>input</strong></td><td>трафик к самому роутеру. Обязательное условие попадания в input — адресом назначения пакета должен быть один из адресов роутера, широковещательный адрес сети или широковещательный адрес работающей на роутере службы. Сюда попадает WinBox, SSH, WebFig, ping, VPN и другой трафик, предназначенный роутеру. В этой цепочке мы должны защищать сам роутер;</td></tr><tr><td style=text-align:center><strong>output</strong></td><td>трафик от роутера. Ответы на прилетевшее в input или новые пакеты от роутера (PING, VPN, SSH-сессия с самого роутера). Эта цепочка редко используется, так как часто роутер считается доверенным звеном и пакеты, генерируемые им, по умолчанию легитимны. Но, как показывает история взломов, контроль исходящего трафика может выявить заражение на начальных этапах;</td></tr><tr><td style=text-align:center><strong>forward</strong></td><td>трафик, проходящий через роутер (когда пакет прилетел в один интерфейс и вылетел с другого или того же самого). Трафик из локальной сети в интернет, из интернета в локальную сеть, из одного VLAN локальной сети в другой;</td></tr><tr><td style=text-align:center><strong>user chains</strong></td><td>пользовательские цепочки. Администратор может создавать цепочки правил по своему усмотрению. Это бывает полезно для декомпозиции больших конфигураций. К примеру, можно весь трафик на порты 80 и 443 завернуть в отдельную цепочку WEB и в ней уже делать десятки правил для фильтрации — это визуально упростит настройку, хотя качественно на прохождение трафика не повлияет.</td></tr></tbody></table><h3 id=категории-статуса-соединения>Категории статуса соединения</h3><table><thead><tr><th>Состояние</th><th>Описание</th></tr></thead><tbody><tr><td><strong>New</strong></td><td>исходя из названия ясно, что это новое соединение, а не одно из существующих.</td></tr><tr><td><strong>Established</strong></td><td>соединение установлено, по нему можно передавать пакеты данных.</td></tr><tr><td><strong>Related</strong></td><td>соединение, которое относится уже к какому-либо из существующих, но используемое в иных целях.</td></tr><tr><td><strong>Invalid</strong></td><td>некорректное соединение, то есть маршрутизатор понятия не имеет, что это за соединение и как его обрабатывать.</td></tr></tbody></table><h2 id=mikrotikcli>Mikrotik:CLI</h2><h3 id=экспорт-логов-через-консольную-строку>Экспорт логов через консольную строку</h3><p>​ Для сохранения всего лог журнала, нужно набрать команды в разделе <strong>LeftSideMenu:Terminal</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>&gt;log
</span></span><span style=display:flex><span>&gt;print file<span style=color:#f92672>=</span>Console.log
</span></span></code></pre></div><h2 id=mikrotiknotes>Mikrotik:Notes</h2><h3 id=извлечение-addresslist-из-ipfirewall>Извлечение AddressList из IP:Firewall</h3><p>Для извлечения таблицы IP адресов прошедших через фильтра и попавшие в AddressList применяется команда:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/ip firewall address-list print file<span style=color:#f92672>=</span>ssh_blacklist where list<span style=color:#f92672>=</span>ssh_blacklist
</span></span></code></pre></div><p>Где</p><p><strong>File=</strong> указывается наименование выходного файла</p><p><strong>list=</strong> указывается наименование экспортируемого AddressList</p><h3 id=изменение-mac-адреса-на-интерфейсе>Изменение MAC адреса на интерфейсе</h3><p>Как же <strong>изменить mac адрес MikroTik</strong>? Заходим в терминал щёлкая new terminal в winbox и пишем:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/interface ethernet set ether1 mac-address<span style=color:#f92672>=</span>XX:XX:XX:XX:XX:XX
</span></span></code></pre></div><p><strong>ether1</strong> - интерфейс на котором меняем MAC</p><p><strong>XX:XX:XX:XX:XX:XX</strong> - новый МАС</p><p>Можно сбросить прописанный MAC с помощь WinBox нажав кнопочку Reset MAC Address:</p><h3 id=сброс-mac-адреса-на-стандартные>Сброс MAC адреса на стандартные</h3><p>Номера интерфейсов (ether1 = 0, ether2 = 1, &mldr;):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>interface ethernet reset-mac-address <span style=color:#ae81ff>0</span>
</span></span></code></pre></div><h3 id=отображение-имени-интерфейсапорта-по-умолчанию>Отображение имени интерфейса(порта) по умолчанию</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/interface ethernet print detail
</span></span></code></pre></div><h3 id=установка-имени-интерфейсапорта-по-умолчанию>Установка имени интерфейса(порта) по умолчанию</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/interface ethernet set <span style=color:#f92672>[</span> find default-name<span style=color:#f92672>=</span>ether1 <span style=color:#f92672>]</span> name<span style=color:#f92672>=</span>ether1
</span></span></code></pre></div><h3 id=изменить-mac-для-bridge>Изменить MAC для BRIDGE</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/interface bridge set Bridge1 admin-mac<span style=color:#f92672>=</span>00:00:00:00:00:02 auto-mac<span style=color:#f92672>=</span>no
</span></span></code></pre></div></section><nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]"><a class="flex w-1/2 items-center rounded-l-md p-6 pr-3 no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]" href=https://devnote.cc/posts/processmanagementpm2/processmanagement/><span class=mr-1.5>←</span><span>PM2. Процесс менеджмент в Linux.</span></a></nav></article></main><footer class="opaco mx-auto flex h-[5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"><div class=mr-auto>&copy; 2023
<a class=link href=https://devnote.cc/>DEVNOTE</a></div></footer></body></html>