<!doctype html><html class="not-ready text-sm lg:text-base" style=--bg:#fff lang=ru-ru><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>PM2. Процесс менеджмент в Linux. - DEVNOTE</title><meta name=theme-color><meta name=description content="PM2 Установка Так как PM2 написан на Node.js и устанавливается с помощью npm, нужно установить их на свой виртуальный сервер:
sudo apt install nodejs sudo apt install npm Теперь устанавливаем сам диспетчер процессов:
npm install pm2 -g Готово! PM2 на сервере.
Настройка PM2 в основном предназначен для приложений Node.js, но работает и с остальными языками программирования. Чтобы запустить приложение, используем команды в консоли.
Для Node.js:
pm start app_name.js Запуск с определенной меткой:"><meta name=author content="DEVNOTE"><link rel="preload stylesheet" as=style href=https://devnote.cc/main.min.css><script defer src=https://devnote.cc/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=preload as=image href=https://devnote.cc/theme.png><link rel=preload as=image href=https://devnote.cc/github.svg><link rel=preload as=image href=https://devnote.cc/cv.svg><link rel=icon href=https://devnote.cc/favicon.ico><link rel=apple-touch-icon href=https://devnote.cc/apple-touch-icon.png><meta name=generator content="Hugo 0.111.3"><meta property="og:title" content="PM2. Процесс менеджмент в Linux."><meta property="og:description" content="PM2 Установка Так как PM2 написан на Node.js и устанавливается с помощью npm, нужно установить их на свой виртуальный сервер:
sudo apt install nodejs sudo apt install npm Теперь устанавливаем сам диспетчер процессов:
npm install pm2 -g Готово! PM2 на сервере.
Настройка PM2 в основном предназначен для приложений Node.js, но работает и с остальными языками программирования. Чтобы запустить приложение, используем команды в консоли.
Для Node.js:
pm start app_name.js Запуск с определенной меткой:"><meta property="og:type" content="article"><meta property="og:url" content="https://devnote.cc/posts/processmanagementpm2/processmanagement/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-22T09:03:20-08:00"><meta property="article:modified_time" content="2022-11-22T09:03:20-08:00"><meta itemprop=name content="PM2. Процесс менеджмент в Linux."><meta itemprop=description content="PM2 Установка Так как PM2 написан на Node.js и устанавливается с помощью npm, нужно установить их на свой виртуальный сервер:
sudo apt install nodejs sudo apt install npm Теперь устанавливаем сам диспетчер процессов:
npm install pm2 -g Готово! PM2 на сервере.
Настройка PM2 в основном предназначен для приложений Node.js, но работает и с остальными языками программирования. Чтобы запустить приложение, используем команды в консоли.
Для Node.js:
pm start app_name.js Запуск с определенной меткой:"><meta itemprop=datePublished content="2022-11-22T09:03:20-08:00"><meta itemprop=dateModified content="2022-11-22T09:03:20-08:00"><meta itemprop=wordCount content="1121"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="PM2. Процесс менеджмент в Linux."><meta name=twitter:description content="PM2 Установка Так как PM2 написан на Node.js и устанавливается с помощью npm, нужно установить их на свой виртуальный сервер:
sudo apt install nodejs sudo apt install npm Теперь устанавливаем сам диспетчер процессов:
npm install pm2 -g Готово! PM2 на сервере.
Настройка PM2 в основном предназначен для приложений Node.js, но работает и с остальными языками программирования. Чтобы запустить приложение, используем команды в консоли.
Для Node.js:
pm start app_name.js Запуск с определенной меткой:"></head><body class="text-black duration-200 ease-out dark:text-white"><header class="mx-auto flex h-[5rem] max-w-3xl px-8 lg:justify-center"><div class="relative z-50 mr-auto flex items-center"><a class="-translate-x-[1px] -translate-y-0.5 text-3xl font-bold" href=https://devnote.cc/>DEVNOTE</a><div class="btn-dark text-[0] ml-6 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.svg)_left_center/cover_no-repeat] dark:invert dark:[background-position:right]" role=button aria-label=Dark></div></div><div class="btn-menu relative z-50 -mr-8 flex h-[5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden" role=button aria-label=Menu></div><script>const htmlClass=document.documentElement.classList;setTimeout(()=>{htmlClass.remove("not-ready")},10);const btnMenu=document.querySelector(".btn-menu");btnMenu.addEventListener("click",()=>{htmlClass.toggle("open")});const metaTheme=document.querySelector('meta[name="theme-color"]'),lightBg=`"#fff"`.replace(/"/g,""),setDark=e=>{metaTheme.setAttribute("content",e?"#000":lightBg),htmlClass[e?"add":"remove"]("dark"),localStorage.setItem("dark",e)},darkScheme=window.matchMedia("(prefers-color-scheme: dark)");if(htmlClass.contains("dark"))setDark(!0);else{const e=localStorage.getItem("dark");setDark(e?e==="true":darkScheme.matches)}darkScheme.addEventListener("change",e=>{setDark(e.matches)});const btnDark=document.querySelector(".btn-dark");btnDark.addEventListener("click",()=>{setDark(localStorage.getItem("dark")!=="true")})</script><div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"><nav class="mt-12 flex justify-center space-x-10 dark:invert lg:mt-0 lg:ml-12 lg:items-center lg:space-x-6"><a class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./github.svg) href=https://github.com/osipud target=_blank rel=me>github</a>
<a class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./cv.svg) href=https://devnote.cc/cv target=_blank rel=me>cv</a></nav></div></header><main class="prose prose-neutral relative mx-auto min-h-[calc(100%-10rem)] max-w-3xl px-8 pt-16 pb-24 dark:prose-invert"><article><header class=mb-20><h1 class="!my-0 pb-2.5">PM2. Процесс менеджмент в Linux.</h1><div class="text-sm opacity-60"><time>Nov 22, 2022</time></div></header><section><h2 id=pm2>PM2</h2><h3 id=установка>Установка</h3><p>Так как PM2 написан на Node.js и устанавливается с помощью npm, нужно установить их на свой виртуальный сервер:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install nodejs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo apt install npm
</span></span></code></pre></div><p>Теперь устанавливаем сам диспетчер процессов:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install pm2 -g
</span></span></code></pre></div><p>Готово! PM2 на сервере.</p><h3 id=настройка>Настройка</h3><p>PM2 в основном предназначен для приложений Node.js, но работает и с остальными языками программирования. Чтобы запустить приложение, используем команды в консоли.</p><p>Для Node.js:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pm start app_name.js
</span></span></code></pre></div><p>Запуск с определенной меткой:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> pm start app_name.js --name <span style=color:#e6db74>&#34;app name&#34;</span>
</span></span></code></pre></div><p>Для остальных языков программирования (на примере Python 3):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pm2 start app_name.py --interpreter<span style=color:#f92672>=</span>python3
</span></span></code></pre></div><p>Если ваше приложение завершит работу с ошибкой, PM2 автоматически перезапустит его, что очень удобно.</p><p>После запуска скриптов и приложений можно посмотреть информацию о них с помощью команды в консоли:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pm2 list
</span></span></code></pre></div><p>Пример того, что мы увидим:</p><p><img src=../image-20220925223235152-1669306825273-1.png alt=image-20220925223235152></p><p>В таблице показано количество рестартов, потребляемая память и нагрузка на процессор от приложений.</p><p>Для удаления, запуска, рестарта и остановки приложений из списка нужно посмотреть порядковый номер (id) процесса в таблице, которую можно вызвать командой, указанной выше, и написать команды в консоли.</p><p>Остановка:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pm2 stop id
</span></span></code></pre></div><p>Запуск:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pm2 start id
</span></span></code></pre></div><p>Рестарт:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pm2 restart id
</span></span></code></pre></div><p>Удаление из списка:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pm2 delete id
</span></span></code></pre></div><p>Также можно просмотреть логи отдельных приложений. Для этого используем эту команду:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pm2 monit
</span></span></code></pre></div><p>И выбираем свое приложение из списка.</p><p><img src=../image-20220925223332869-1669306851385-3.png alt=image-20220925223332869></p><p>Если вам неудобно следить за логами и запуском приложений через консоль, то это можно делать даже в браузере, установив веб-версию PM2 одной командой:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pm2 plus
</span></span></code></pre></div><p>После этого вводим свои данные для регистрации и переходим по ссылке, которая отобразится в консоли.</p><p>Пример того, что мы увидим:</p><p><img src=../image-20220925223354290-1669306854438-5.png alt=image-20220925223354290></p><h2 id=ps>PS</h2><h3 id=что-такое-процесс>Что такое процесс?</h3><p>Чтобы понять что отображает команда ps сначала надо разобраться что такое процесс. Процесс Linux - это экземпляр программы, запущенный в памяти. Все процессы можно разделить на обычные и фоновые. Более подробно об этом написано в статье <a href=https://losst.ru/upravlenie-protsessami-v-linux>управление процессами Linux</a>. Linux - это многопользовательская система, каждый пользователь может запускать одни и те же программы, и даже один пользователь может захотеть запустить несколько экземпляров одной программы, поэтому ядру нужно как-то идентифицировать такие однотипные процессы. Для этого каждому процессу присваивается PID (Proccess Identificator).</p><p>Каждый из процессов может находиться в одном из таких состояний:</p><ul><li><strong>Запуск</strong> - процесс либо уже работает, либо готов к работе и ждет, когда ему будет дано процессорное время;</li><li><strong>Ожидание</strong> - процессы в этом состоянии ожидают какого-либо события или освобождения системного ресурса. Ядро делит такие процессы на два типа - те, которые ожидают освобождения аппаратных средств и приостановление с помощью сигнала;</li><li><strong>Остановлено</strong> - обычно, в этом состоянии находятся процессы, которые были остановлены с помощью сигнала;</li><li><strong>Зомби</strong> - это мертвые процессы, они были остановлены и больше не выполняются, но для них есть запись в таблице процессов, возможно, из-за того, что у процесса остались дочерние процессы.</li></ul><h3 id=команда-ps-в-linux>Команда ps в Linux</h3><p>Сначала рассмотрим общий синтаксис команды, здесь все очень просто:</p><pre tabindex=0><code>$ ps опции

$ ps опции | grep параметр
</code></pre><p>Во втором варианте мы используем утилиту grep для того, чтобы отобрать нужные нам процессы по определенному критерию. Теперь рассмотрим опции утилиты. Они делятся на два типа - те, которые идут с дефисом Unix и те, которые используются без дефиса - BSD. Лучше пользоваться только опциями Unix, но мы рассмотрим и одни и другие. Заметьте, что при использовании опций BSD, вывод утилиты будет организован в BSD стиле.</p><h4 id=дополнительные-опции>Дополнительные опции</h4><ul><li><strong>-A, -e, (a)</strong> - выбрать все процессы;</li><li><strong>-a</strong> - выбрать все процессы, кроме фоновых;</li><li><strong>-d, (g)</strong> - выбрать все процессы, даже фоновые, кроме процессов сессий;</li><li><strong>-N</strong> - выбрать все процессы кроме указанных;</li><li><strong>-С</strong> - выбирать процессы по имени команды;</li><li><strong>-G</strong> - выбрать процессы по ID группы;</li><li><strong>-p, (p)</strong> - выбрать процессы PID;</li><li><strong>&ndash;ppid</strong> - выбрать процессы по PID родительского процесса;</li><li><strong>-s</strong> - выбрать процессы по ID сессии;</li><li><strong>-t, (t)</strong> - выбрать процессы по tty;</li><li><strong>-u, (U)</strong> - выбрать процессы пользователя.</li></ul><h4 id=опции-форматирования>Опции форматирования</h4><ul><li><strong>-с</strong> - отображать информацию планировщика;</li><li><strong>-f</strong> - вывести максимум доступных данных, например, количество потоков;</li><li><strong>-F</strong> - аналогично -f, только выводит ещё больше данных;</li><li><strong>-l</strong> - длинный формат вывода;</li><li><strong>-j, (j)</strong> - вывести процессы в стиле Jobs, минимум информации;</li><li><strong>-M, (Z)</strong> - добавить информацию о безопасности;</li><li><strong>-o, (o)</strong> - позволяет определить свой формат вывода;</li><li><strong>&ndash;sort, (k)</strong> - выполнять сортировку по указанной колонке;</li><li><strong>-L, (H)</strong>- отображать потоки процессов в колонках LWP и NLWP;</li><li><strong>-m, (m)</strong> - вывести потоки после процесса;</li><li><strong>-V, (V)</strong> - вывести информацию о версии;</li><li><strong>-H</strong> - отображать дерево процессов;</li></ul><h3 id=практика>Практика</h3><p>Теперь, когда вы знаете синтаксис и опции, можно перейти ближе к практике. Чтобы просто посмотреть процессы в текущей оболочке используется такая команда терминала ps:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> ps
</span></span></code></pre></div><p><img src=../image-20220925225053092-1669306867756-7.png alt=image-20220925225053092></p><p>Все процессы, кроме лидеров групп, в том же режиме отображения:</p><pre tabindex=0><code>ps -A
</code></pre><p><img src=../image-20220925225115905-1669306871467-9.png alt=image-20220925225115905></p><p>Все процессы, включая фоновые и лидеры групп:</p><pre tabindex=0><code>ps -d
</code></pre><p><img src=../image-20220925225158357-1669306873720-11.png alt=image-20220925225158357></p><p>Чтобы вывести больше информации о процессах используйте опцию <strong>-f</strong>:</p><pre tabindex=0><code>ps -f
</code></pre><p><img src=../image-20220925225222659-1669306875552-13.png alt=image-20220925225222659></p><p>При использовании опции <strong>-f</strong> команда выдает такие колонки:</p><ul><li><strong>UID</strong> - пользователь, от имени которого запущен процесс;</li><li><strong>PID</strong> - идентификатор процесса;</li><li><strong>PPID</strong> - идентификатор родительского процесса;</li><li><strong>C</strong> - процент времени CPU, используемого процессом;</li><li><strong>STIME</strong> - время запуска процесса;</li><li><strong>TTY</strong> - терминал, из которого запущен процесс;</li><li><strong>TIME</strong> - общее время процессора, затраченное на выполнение процессора;</li><li><strong>CMD</strong> - команда запуска процессора;</li><li><strong>LWP</strong> - показывает потоки процессора;</li><li><strong>PRI</strong> - приоритет процесса.</li></ul><p>Например, также можно вывести подробную информацию обо всех процессах:</p><pre tabindex=0><code>ps -Af
</code></pre><p><img src=../image-20220925225305820-1669306878329-15.png alt=image-20220925225305820></p><p>Больше информации можно получить, использовав опцию <strong>-F:</strong></p><pre tabindex=0><code> ps -Fe
</code></pre><p><img src=../image-20220925225332612-1669306880411-17.png alt=image-20220925225332612></p><p>Эта опция добавляет такие колонки:</p><ul><li><strong>SZ</strong> - это размер процесса в памяти;</li><li><strong>RSS</strong> - реальный размер процесса в памяти;</li><li><strong>PSR</strong> - ядро процессора, на котором выполняется процесс.</li></ul><p>Если вы хотите получить еще больше информации, используйте вместо <strong>-f</strong> опцию <strong>-l</strong>:</p><pre tabindex=0><code> ps -l
</code></pre><p><img src=../image-20220925225407050-1669306884377-19.png alt=image-20220925225407050></p><p>Эта опция добавляет отображение таких колонок:</p><ul><li><strong>F</strong> - флаги, ассоциированные с этим процессом;</li><li><strong>S</strong> - состояние процесса;</li><li><strong>PRI</strong> - приоритет процесса в планировщике ядра Linux;</li><li><strong>NI</strong> - рекомендованный приоритет процесса, можно менять;</li><li><strong>ADDR</strong> - адрес процесса в памяти;</li><li><strong>WCHAN</strong> - название функции ядра, из-за которой процесс находится в режиме ожидания.</li></ul><p>Дальше мы можем отобрать все процессы, запущенные от имени определенного пользователя:</p><pre tabindex=0><code> ps -fu root
</code></pre><p><img src=../image-20220925225436953-1669306888479-21.png alt=image-20220925225436953></p><p>С помощью опции <strong>-H</strong> можно отобразить дерево процессов:</p><pre tabindex=0><code> ps -fHu root
</code></pre><p><img src=../image-20220925225502143-1669306892573-23.png alt=image-20220925225502143></p><p>Если вас интересует информация только об определенном процессе, то вы можете использовать опцию <strong>-p</strong> и указать PID процесса:</p><pre tabindex=0><code> ps -fp 1
</code></pre><p><img src=../image-20220925225529252-1669306895478-25.png alt=image-20220925225529252></p><p>Через запятую можно указать несколько PID:</p><pre tabindex=0><code> ps -fp 1,2,3
</code></pre><p><img src=../image-20220925225547198-1669306898345-27.png alt=image-20220925225547198></p><p>Опция <strong>-С</strong> позволяет фильтровать процессы по имени, например, выберем только процессы chrome:</p><pre tabindex=0><code> ps -fC chrome
</code></pre><p><img src=../image-20220925225611648-1669306902326-29.png alt=image-20220925225611648></p><p>Дальше можно использовать опцию <strong>-L</strong> чтобы отобразить информацию о процессах:</p><pre tabindex=0><code> ps -fL
</code></pre><p><img src=../image-20220925225629502-1669306905931-31.png alt=image-20220925225629502></p><p>Очень интересно то, с помощью опции <strong>-o</strong> можно настроить форматирование вывода, например, вы можете вывести только pid процесса и команду:</p><pre tabindex=0><code>ps -o pid,comm
</code></pre><p><img src=../image-20220925225655727-1669306909107-33.png alt=image-20220925225655727></p><p>Вы можете выбрать такие колонки для отображения: <strong>pcpu, pmem, args, comm, cputime, pid, gid, lwp, rss, start, user, vsize, priority</strong>. Для удобства просмотра можно отсортировать вывод программы по нужной колонке, например, просмотр процессов, которые используют больше всего памяти:</p><pre tabindex=0><code> ps -Fe --sort rss
</code></pre><p><img src=../image-20220925225713788-1669306911895-35.png alt=image-20220925225713788></p><p>Или по проценту загрузки cpu:</p><pre tabindex=0><code> ps -FA --sort pcpu
</code></pre><p><img src=../image-20220925225732076-1669306915279-37.png alt=image-20220925225732076></p><p>Ещё одна опция - <strong>-M</strong>, которая позволяет вывести информацию про права безопасности и флаги SELinux для процессов:</p><pre tabindex=0><code> ps -eM
</code></pre><p><img src=../image-20220925225754615-1669306918424-39.png alt=image-20220925225754615></p><p>Общее количество запущенных процессов Linux можно узнать командой:</p><pre tabindex=0><code> ps -e | wc
</code></pre><p><img src=../image-20220925225818868-1669306922491-41.png alt=image-20220925225818861></p></section><nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]"><a class="ml-auto flex w-1/2 items-center justify-end rounded-r-md p-6 pl-3 no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]" href=https://devnote.cc/posts/mikrotikconfiguration/mikrotik/><span>Mikrotik Configuration</span><span class=ml-1.5>→</span></a></nav></article></main><footer class="opaco mx-auto flex h-[5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"><div class=mr-auto>&copy; 2023
<a class=link href=https://devnote.cc/>DEVNOTE</a></div></footer></body></html>